<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ù…Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    body { direction: rtl; font-family: sans-serif; }
    #map { height: 90vh; }
  </style>
</head>
<body>
  <h3>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù†Ø¯Ù‡</h3>
  <div id="info">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script>
    let map = L.map('map').setView([35.7, 51.4], 13); // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    let marker = null;

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    async function updateMap() {
      const res = await fetch("/coords");
      const data = await res.json();

      if (data.status === "no-data") {
        document.getElementById("info").textContent = "ğŸ“­ Ù‡Ù†ÙˆØ² Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯Ù‡";
        return;
      }

      document.getElementById("info").innerHTML = `
        Ø¹Ø±Ø¶: ${data.lat} | Ø·ÙˆÙ„: ${data.lon} | Ø¯Ù‚Øª: ${data.accuracy} Ù…ØªØ± | Ø²Ù…Ø§Ù†: ${data.time}
      `;

      const latlng = [data.lat, data.lon];
      map.setView(latlng, 16);

      if (marker) {
        marker.setLatLng(latlng);
      } else {
        marker = L.marker(latlng).addTo(map);
      }
    }

    updateMap();
    setInterval(updateMap, 5000); // Ù‡Ø± Ûµ Ø«Ø§Ù†ÛŒÙ‡
  </script>
</body>
</html>
